<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Read Blog - BlogZone</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
      integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.css"
      integrity="sha512-kJlvECunwXftkPwyvHbclArO8wszgBGisiLeuDFwNM8ws+wKIw0sv1os3ClWZOcrEB2eRXULYUsm8OVRGJKwGA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="./style/home.css" />
    <link rel="stylesheet" href="./style/profile.css" />
    <link rel="stylesheet" href="./style/homeCssRes.css" />
    <style>
        /* Blog Reading Page Styles */
        .blog-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            border-radius: 12px;
            margin-top: 20px;
        }

        .blog-header {
            border-bottom: 1px solid #333;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .blog-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 15px;
            line-height: 1.2;
        }

        .blog-meta {
            display: flex;
            align-items: center;
            gap: 20px;
            color: #999;
            font-size: 0.9rem;
        }

        .author-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .author-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .author-details h4 {
            color: #fff;
            margin: 0;
            font-size: 1rem;
        }

        .author-details p {
            margin: 0;
            font-size: 0.85rem;
            color: #999;
        }

        .blog-image {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border-radius: 8px;
            margin: 30px 0;
        }

        .blog-content {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #e0e0e0;
            margin-bottom: 30px;
        }

        .blog-content p {
            margin-bottom: 20px;
        }

        .blog-content h2 {
            color: #fff;
            font-size: 1.8rem;
            margin: 30px 0 15px 0;
        }

        .blog-content h3 {
            color: #fff;
            font-size: 1.4rem;
            margin: 25px 0 12px 0;
        }

        .blog-tags {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tag {
            background: #6366f1;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            text-decoration: none;
        }

        .tag:hover {
            background: #4f46e5;
        }

        .blog-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-top: 1px solid #333;
            margin-top: 30px;
        }

        .action-buttons {
            display: flex;
            gap: 20px;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: none;
            border: 1px solid #444;
            color: #e0e0e0;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .action-btn:hover {
            background: #333;
            border-color: #6366f1;
            color: #fff;
        }

        .action-btn.liked {
            background: #6366f1;
            border-color: #6366f1;
            color: white;
        }

        .action-btn.bookmarked {
            background: #f59e0b;
            border-color: #f59e0b;
            color: white;
        }

        .blog-stats {
            color: #999;
            font-size: 0.9rem;
        }

        .related-posts {
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid #333;
        }

        .related-posts h3 {
            color: #fff;
            margin-bottom: 20px;
        }

        .related-post {
            display: flex;
            gap: 15px;
            padding: 15px;
            border: 1px solid #333;
            border-radius: 8px;
            margin-bottom: 15px;
            transition: background 0.3s ease;
            text-decoration: none;
        }

        .related-post:hover {
            background: #222;
        }

        .related-post img {
            width: 80px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
        }

        .related-post-content h4 {
            color: #fff;
            margin: 0 0 5px 0;
            font-size: 1rem;
        }

        .related-post-content p {
            color: #999;
            margin: 0;
            font-size: 0.85rem;
        }.blog-meta-separator{
          display: flex;
          align-items: center;
          gap: 5px;
        }

        @media (max-width: 768px) {
            .blog-container {
                margin: 10px;
                padding: 15px;
            }
            .blog-container img{
                  width: 100%;
    max-height: 400px;
    object-fit: cover;
    border-radius: 8px;
    margin: 30px 0;
            }

            .blog-title {
                font-size: 2rem;
            }

            .blog-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .action-buttons {
                flex-wrap: wrap;
                gap: 10px;
            }
            .blog-actions{
              flex-direction: column;
              gap: 10px;
            }
        }
    </style>
  </head>
  <body>
    <div class="help-card hidden">
      <h3 style="margin-top: 0">Need help?</h3>
      <span>
        Welcome to <strong>BlogZone</strong>! Here you can read, write, and
        share blogs with the community.<br /><br />
        <ul style="padding-left: 18px; margin: 0">
          <li>Use the <b>Write</b> button to create a new blog post.</li>
          <li>
            Click your profile image to manage your account or copy your profile
            link.
          </li>
          <li>Bookmark your favorite blogs for qu id="logout"ick access.</li>
          <li>Check your stats to see your blog performance.</li>
        </ul>
        <br />
        For more help, contact us via the links in the footer.
      </span>
    </div>
    <div class="profile-card hidden">
      <div class="userinfo">
        <img src="./assets/my-av.jpeg" alt="" />
        <div>
          <div class="fullname">unknown Kumar</div>
          <div class="email">unknownkukran123@gmail.com</div>
        </div>
      </div>
      <div class="btns">
        <a href="profile.html" class="btn"
          ><i class="ri-user-settings-fill"></i> Manage account</a
        >
        <a href="index.html" class="btn" onclick="logout()"
          ><i class="fa-solid fa-right-from-bracket"></i> Logout</a
        >
      </div>
      <div class="links">
        <button
          class="btn"
          onclick="copyToClipboard(event, 'https://blogzone.com/@unknownkumar07')"
          style="
            background: none;
            border: none;
            color: #cacfd9;
            cursor: pointer;
          "
        >
          https://blogzone.com/@unknownkumar07 <i class="ri-clipboard-fill"></i>
        </button>
      </div>
    </div>
    <nav>
      <a href="index.html">
        <div class="logo">
          <i class="fa-solid fa-blog"></i>
          <div class="name">BlogZone</div>
        </div>
      </a>
      <div class="search">
        <div class="icon">
          <i class="fa-solid fa-magnifying-glass"></i>
        </div>
        <div class="searchbar">
          <input type="search" placeholder="| Search your blog..." />
        </div>
      </div>
      <div class="nav-list">
        <div class="write-blog">
          <div class="icon">
            <i class="fa-regular fa-pen-to-square"></i>
          </div>
          <span>Write</span>
        </div>
        <div class="help" onclick="showHelpCard()">
          <i class="fa-solid fa-circle-info"></i>
        </div>
        <div class="profile" onclick="showCard()">
          <img src="./assets/my-av.jpeg" alt="" />
        </div>
      </d id="logout"iv>
    </nav>

    <div class="container">
      <div class="sidebar">
        <ul class="topbar">
          <li onclick="window.location.href='home.html'"><i class="fa-solid fa-house"></i> Home</li>
          <li onclick="window.location.href='bookmark.html'"><i class="fa-solid fa-bookmark"></i> Bookmark</li>
          <li onclick="window.location.href='profile.html'"><i class="fa-solid fa-user"></i> Profile</li>
          <li onclick="window.location.href='stat.html'"><i class="fa-solid fa-chart-simple"></i> Stats</li>
        </ul>
        <ul class="bottombar" onclick="logout()" >
          <li onclick="window.location.href='index.html'"><i class="fa-solid fa-right-from-bracket"></i> Logout</li>
        </ul>
      </div>

      <div class="content">
        <div class="blog-container">
          <!-- Blog Header -->
          <div class="blog-header">
            <h1 class="blog-title" id="blogTitle">Loading...</h1>
            <div class="blog-meta">
              <div class="author-info">
                <img src="./assets/my-av.jpeg" alt="Author" class="author-avatar" id="authorAvatar">
                <div class="author-details">
                  <h4 id="authorName">Loading...</h4>
                  <p id="authorUsernameWrapper"><a id="authorUsername" href="#">@loading</a></p>
                </div>
              </div>
              <span class="blog-meta-separator">
                              <span>•</span>
              <span id="publishDate">Published on ...</span>
              <span>•</span>
              <span id="readTime">... min read</span>
              <span>•</span>
              <span id="viewCount">... views</span>
              </span>
            </div>
          </div>

          <!-- Blog Tags -->
          <div class="blog-tags" id="blogTags">
            <!-- Tags will be loaded dynamically -->
          </div>

          <!-- Featured Image -->
          <img src="" alt="Blog Image" class="blog-image" id="blogImage">

          <!-- Blog Content -->
          <div class="blog-content" id="blogContent">
            <p>Loading content...</p>
          </div>

          <!-- Blog Actions -->
          <div class="blog-actions">
            <div class="action-buttons">
              <button class="action-btn" id="likeBtn">
                <i class="fa-regular fa-heart"></i>
                <span id="likeText">Like (0)</span>
              </button>
              <button class="action-btn" id="bookmarkBtn">
                <i class="fa-regular fa-bookmark"></i>
                <span id="bookmarkText">Bookmark</span>
              </button>
              <button class="action-btn" id="shareBtn">
                <i class="fa-solid fa-share"></i>
                <span>Share</span>
              </button>
            </div>
            <div class="blog-stats" id="blogStats">
              Views: 0 • Likes: 0
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- <script type="module">
        import { getBlogById, updateBlogLikes, toggleBookmark as toggleBookmarkAPI, incrementViews } from './src/api/api.js';

        // Get blog ID from URL parameters or default to 1
        const urlParams = new URLSearchParams(window.location.search);
        const blogId = urlParams.get('id') || '1';
        let currentBlog = null;
        let viewsIncremented = false; // Flag to prevent multiple view increments

        // Load blog content when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadBlogContent(blogId);
        });

        function loadBlogContent(id) {
            currentBlog = getBlogById(id);
            
            if (!currentBlog) {
                document.getElementById('blogContent').innerHTML = '<p>Blog not found!</p>';
                return;
            }

            // Store original view count for debugging
            const originalViews = currentBlog.views;
            console.log('Original views:', originalViews);

            // Increment views only once per page load
            if (!viewsIncremented) {
                const newViews = incrementViews(id);
                console.log('Views after increment:', newViews);
                viewsIncremented = true;
            }

            // Update page title
            document.title = `${currentBlog.title} - BlogZone`;

            // Populate blog header
            document.getElementById('blogTitle').textContent = currentBlog.title;
            document.getElementById('authorAvatar').src = currentBlog.avatar;
            document.getElementById('authorName').textContent = currentBlog.fullname;
            document.getElementById('authorUsername').textContent = currentBlog.username;
            document.getElementById('publishDate').textContent = `Published on ${currentBlog.publishDate}`;
            document.getElementById('readTime').textContent = currentBlog.readTime;
            document.getElementById('viewCount').textContent = `${currentBlog.views} views`;

            // Populate blog image
            document.getElementById('blogImage').src = currentBlog.banner;
            document.getElementById('blogImage').alt = currentBlog.title;

            // Populate blog content
            document.getElementById('blogContent').innerHTML = currentBlog.content;

            // Populate blog tags
            const tagsContainer = document.getElementById('blogTags');
            tagsContainer.innerHTML = '';
            currentBlog.tags.forEach(tag => {
                const tagElement = document.createElement('a');
                tagElement.href = '#';
                tagElement.className = 'tag';
                tagElement.textContent = tag;
                tagsContainer.appendChild(tagElement);
            });

            // Update action buttons
            document.getElementById('likeText').textContent = `Like (${currentBlog.likes})`;
            document.getElementById('blogStats').textContent = `Views: ${currentBlog.views} • Likes: ${currentBlog.likes}`;

            // Set bookmark state
            const bookmarkBtn = document.getElementById('bookmarkBtn');
            const bookmarkIcon = bookmarkBtn.querySelector('i');
            const bookmarkText = document.getElementById('bookmarkText');
            
            if (currentBlog.bookmarked) {
                bookmarkIcon.classList.remove('fa-regular');
                bookmarkIcon.classList.add('fa-solid');
                bookmarkIcon.style.color = '#f39c12';
                bookmarkText.textContent = 'Bookmarked';
                bookmarkBtn.style.color = '#f39c12';
            }

            // Load related posts
            loadRelatedPosts(currentBlog.relatedPosts);
        }

        function loadRelatedPosts(relatedPosts) {
            const relatedPostsContainer = document.getElementById('relatedPosts');
            relatedPostsContainer.innerHTML = '';

            relatedPosts.forEach(post => {
                const postElement = document.createElement('a');
                postElement.href = `blog.html?id=${post.id}`;
                postElement.className = 'related-post';
                
                postElement.innerHTML = `
                    <img src="${post.image}" alt="Related post">
                    <div class="related-post-content">
                        <h4>${post.title}</h4>
                        <p>${post.desc}</p>
                    </div>
                `;
                
                relatedPostsContainer.appendChild(postElement);
            });
        }

        // Toggle like functionality
        window.toggleLike = function(button) {
            if (!currentBlog) return;

            const icon = button.querySelector('i');
            const span = button.querySelector('span');
            const currentLikes = currentBlog.likes;
            
            if (icon.classList.contains('fa-regular')) {
                icon.classList.remove('fa-regular');
                icon.classList.add('fa-solid');
                icon.style.color = '#e74c3c';
                
                // Update API
                const newLikes = updateBlogLikes(currentBlog.id, true);
                currentBlog.likes = newLikes;
                
                span.textContent = `Like (${newLikes})`;
                button.style.color = '#e74c3c';
                
                // Update stats
                document.getElementById('blogStats').textContent = `Views: ${currentBlog.views} • Likes: ${currentBlog.likes}`;
            } else {
                icon.classList.remove('fa-solid');
                icon.classList.add('fa-regular');
                icon.style.color = '';
                
                // Update API
                const newLikes = updateBlogLikes(currentBlog.id, false);
                currentBlog.likes = newLikes;
                
                span.textContent = `Like (${newLikes})`;
                button.style.color = '';
                
                // Update stats
                document.getElementById('blogStats').textContent = `Views: ${currentBlog.views} • Likes: ${currentBlog.likes}`;
            }
        }

        // Toggle bookmark functionality
        window.toggleBookmark = function(button) {
            if (!currentBlog) return;

            const icon = button.querySelector('i');
            const span = button.querySelector('span');
            
            // Update API
            const isBookmarked = toggleBookmarkAPI(currentBlog.id);
            currentBlog.bookmarked = isBookmarked;
            
            if (isBookmarked) {
                icon.classList.remove('fa-regular');
                icon.classList.add('fa-solid');
                icon.style.color = '#f39c12';
                span.textContent = 'Bookmarked';
                button.style.color = '#f39c12';
            } else {
                icon.classList.remove('fa-solid');
                icon.classList.add('fa-regular');
                icon.style.color = '';
                span.textContent = 'Bookmark';
                button.style.color = '';
            }
        }

        // Share functionality
        window.sharePost = function() {
            if (!currentBlog) return;

            if (navigator.share) {
                navigator.share({
                    title: currentBlog.title,
                    text: currentBlog.desc,
                    url: window.location.href
                });
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(window.location.href).then(() => {
                    alert('Link copied to clipboard!');
                });
            }
        }

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth'
                    });
                }
            });
        });
    </script> -->
  </body>
  <script src="./src/js/home.js"></script>
  <script>


// Share post functionality
async function sharePost(element) {
  try {
    const card = element.closest(".card");
    if (!card) return;

    // Extract blog details
    const blogLink = card.querySelector('a[href*="blog.html?id="]');
    const titleElement = card.querySelector("h2");

    if (!blogLink || !titleElement) return;

    const blogUrl = new URL(blogLink.href, window.location.origin).href;
    const blogTitle = titleElement.textContent;

    if (navigator.share) {
      await navigator.share({
        title: blogTitle,
        text: `Check out this blog: ${blogTitle}`,
        url: blogUrl,
      });
    } else {
      // Fallback: copy to clipboard
      await navigator.clipboard.writeText(blogUrl);
      showSuccessMessage("Blog link copied to clipboard!");
    }
  } catch (error) {
    console.error("Error sharing post:", error);
    showErrorMessage("Error sharing blog");
  }
}

// Success message function
function showSuccessMessage(message) {
  // Add slide-in animation CSS if not already added
  if (!document.getElementById("toast-styles")) {
    const style = document.createElement("style");
    style.id = "toast-styles";
    style.textContent = `
      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }
    `;
    document.head.appendChild(style);
  }

  // Create a simple success toast
  const toast = document.createElement("div");
  toast.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: #10b981;
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    font-weight: 500;
    z-index: 10000;
    animation: slideIn 0.3s ease-out;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  `;
  toast.textContent = message;

  document.body.appendChild(toast);

  setTimeout(() => {
    toast.style.animation = "slideOut 0.3s ease-in";
    setTimeout(() => {
      toast.remove();
    }, 300);
  }, 2700);
}

    document.addEventListener('DOMContentLoaded', function() {
      var likeBtn = document.getElementById('likeBtn');
      var bookmarkBtn = document.getElementById('bookmarkBtn');
      var shareBtn = document.getElementById('shareBtn');
      if (likeBtn) {
        likeBtn.addEventListener('click', likePostSingle);
      }
      if (bookmarkBtn) {
        bookmarkBtn.addEventListener('click', bookmarkPostSingle);
      }
      if (shareBtn) {
        shareBtn.addEventListener('click', sharePostSingle);
      }
    });

    // Dedicated share for single blog view
    function sharePostSingle() {
      const blogTitle = document.getElementById('blogTitle')?.textContent || 'BlogZone';
      const blogDesc = document.getElementById('blogContent')?.textContent?.slice(0, 120) || '';
      const blogUrl = window.location.href;
      if (navigator.share) {
        navigator.share({
          title: blogTitle,
          text: blogDesc,
          url: blogUrl
        });
      } else {
        navigator.clipboard.writeText(blogUrl).then(() => {
          showSuccessMessage('Blog link copied to clipboard!');
        });
      }
    }
  </script>
  <script>
    // Dedicated like/bookmark logic for single blog view
    let currentBlogId = null;
    let likeInProgress = false;
    let bookmarkInProgress = false;
    // Get blog id from URL
    (function() {
      const params = new URLSearchParams(window.location.search);
      currentBlogId = params.get('id');
    })();

    async function likePostSingle(e) {
      if (likeInProgress || !currentBlogId) return;
      likeInProgress = true;
      const likeBtn = document.getElementById('likeBtn');
      const likeText = document.getElementById('likeText');
      const blogStats = document.getElementById('blogStats');
      const userEmail = localStorage.getItem('userEmail');
      if (!userEmail) {
        alert('You must be logged in to like a blog.');
        likeInProgress = false;
        return;
      }
      const icon = likeBtn.querySelector('i');
      likeBtn.disabled = true;
      icon.className = 'fa-solid fa-spinner fa-spin';
      likeText.textContent = 'Liking...';
      try {
        const res = await fetch('http://localhost:8080/api/product/like', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ blogId: currentBlogId, email: userEmail })
        });
        if (res.ok) {
          const data = await res.json();
          likeText.textContent = `Like (${data.likes})`;
          blogStats.textContent = blogStats.textContent.replace(/Likes: \d+/, `Likes: ${data.likes}`);
          icon.className = data.liked ? 'fa-solid fa-heart' : 'fa-regular fa-heart';
          icon.style.color = data.liked ? '#e74c3c' : '';
          likeBtn.style.color = data.liked ? '#e74c3c' : '';
        } else {
          likeText.textContent = 'Like';
          alert('Failed to like blog.');
        }
      } catch (err) {
        likeText.textContent = 'Like';
        alert('Error liking blog.');
      }
      likeBtn.disabled = false;
      likeInProgress = false;
    }

    async function bookmarkPostSingle() {
      if (bookmarkInProgress || !currentBlogId) return;
      bookmarkInProgress = true;
      const bookmarkBtn = document.getElementById('bookmarkBtn');
      const bookmarkText = document.getElementById('bookmarkText');
      const userEmail = localStorage.getItem('userEmail');
      if (!userEmail) {
        alert('You must be logged in to bookmark a blog.');
        bookmarkInProgress = false;
        return;
      }
      const icon = bookmarkBtn.querySelector('i');
      bookmarkBtn.disabled = true;
      icon.className = 'fa-solid fa-spinner fa-spin';
      bookmarkText.textContent = 'Processing...';
      try {
        const res = await fetch('http://localhost:8080/api/product/bookmark', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ blogId: currentBlogId, email: userEmail })
        });
        if (res.ok) {
          const data = await res.json();
          if (data.bookmarked) {
            icon.className = 'fa-solid fa-bookmark';
            icon.style.color = '#f39c12';
            bookmarkText.textContent = 'Bookmarked';
            bookmarkBtn.style.color = '#f39c12';
          } else {
            icon.className = 'fa-regular fa-bookmark';
            icon.style.color = '';
            bookmarkText.textContent = 'Bookmark';
            bookmarkBtn.style.color = '';
          }
        } else {
          bookmarkText.textContent = 'Bookmark';
          alert('Failed to bookmark blog.');
        }
      } catch (err) {
        bookmarkText.textContent = 'Bookmark';
        alert('Error bookmarking blog.');
      }
      bookmarkBtn.disabled = false;
      bookmarkInProgress = false;
    }

    document.addEventListener('DOMContentLoaded', function() {
      var likeBtn = document.getElementById('likeBtn');
      var bookmarkBtn = document.getElementById('bookmarkBtn');
      if (likeBtn) {
        likeBtn.addEventListener('click', likePostSingle);
      }
      if (bookmarkBtn) {
        bookmarkBtn.addEventListener('click', bookmarkPostSingle);
      }
    });
  </script>
</html>